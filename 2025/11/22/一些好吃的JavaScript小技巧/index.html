<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>一些好吃的JavaScript小技巧 | ElectroDragon's Blog</title><meta name="author" content="ElectroDragon"><meta name="copyright" content="ElectroDragon"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="离散地整理一下我在折腾微信小程序时学到的一些JS小技巧。持续更新中。">
<meta property="og:type" content="article">
<meta property="og:title" content="一些好吃的JavaScript小技巧">
<meta property="og:url" content="https://blog.electro-dragon.site/2025/11/22/%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%90%83%E7%9A%84JavaScript%E5%B0%8F%E6%8A%80%E5%B7%A7/index.html">
<meta property="og:site_name" content="ElectroDragon&#39;s Blog">
<meta property="og:description" content="离散地整理一下我在折腾微信小程序时学到的一些JS小技巧。持续更新中。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-material.electro-dragon.site/my_avatar.png">
<meta property="article:published_time" content="2025-11-22T12:51:31.000Z">
<meta property="article:modified_time" content="2025-12-23T13:15:04.162Z">
<meta property="article:author" content="ElectroDragon">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-material.electro-dragon.site/my_avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "一些好吃的JavaScript小技巧",
  "url": "https://blog.electro-dragon.site/2025/11/22/%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%90%83%E7%9A%84JavaScript%E5%B0%8F%E6%8A%80%E5%B7%A7/",
  "image": "https://blog-material.electro-dragon.site/my_avatar.png",
  "datePublished": "2025-11-22T12:51:31.000Z",
  "dateModified": "2025-12-23T13:15:04.162Z",
  "author": [
    {
      "@type": "Person",
      "name": "ElectroDragon",
      "url": "https://blog.electro-dragon.site/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.electro-dragon.site/2025/11/22/%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%90%83%E7%9A%84JavaScript%E5%B0%8F%E6%8A%80%E5%B7%A7/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/null"/><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon_32.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon_16.ico"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: ElectroDragon","link":"链接: ","source":"来源: ElectroDragon's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '一些好吃的JavaScript小技巧',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/bg.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/title.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="image-loading-box"><div class="loading-bg"></div><div class="image-container"><img class="load-image" src="https://blog-material.electro-dragon.site/keqing_bg.png" alt=""/></div></div><script>(()=>{
  const $loadingBox = document.getElementById('image-loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/./css/pace.css"/><script src="/js/pace.js"></script><div id="web_bg" style="background-image: url(https://blog-material.electro-dragon.site/default_background_img.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://blog-material.electro-dragon.site/my_avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://blog-material.electro-dragon.site/my_logo.png" alt="Logo"></a><a class="nav-page-title" href="/"><span class="site-name">一些好吃的JavaScript小技巧</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">一些好吃的JavaScript小技巧</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-22T12:51:31.000Z" title="发表于 2025-11-22 20:51:31">2025-11-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-23T13:15:04.162Z" title="更新于 2025-12-23 21:15:04">2025-12-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/">实用教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>实际上是开发微信小程序我踩过的一些坑，也是我的学习笔记，如果你想实现类似的功能，或者遇到类似问题，可以参考这篇文章。</p>
<hr>
<ol>
<li>
<h3 id="针对多维数组，在原有数据的后面追加数据">针对多维数组，在原有数据的后面追加数据</h3>
<p><strong>知识点</strong>：<code>...</code>扩展运算符，用于数组的展开。</p>
<p>**情景：**包含时间、传感器值的二维数据的数组，形如<code>[[11:45:14, 1.23], [11:45:15, 2.33]]</code>。需要在后面插入相同形式的数据。</p>
<p><strong>方法</strong>：使用扩展运算符<code>...</code>展开原数组和追加数组，然后合并为新数组。</p>
<p><strong>例子</strong>：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> oldData = res.<span class="property">data</span> || [];</span><br><span class="line"><span class="keyword">const</span> newData = [...oldData, ...removed];</span><br><span class="line">wx.<span class="title function_">setStorageSync</span>(currentDate, newData);</span><br></pre></td></tr></table></figure>
<p><strong>Q&amp;A</strong>：</p>
<ul>
<li>
<p><strong>Q</strong>：为什么不能直接写<code>[oldData, removed]</code>？</p>
<p><strong>A</strong>：因为数组没展开，返回的是2个二维数组，是错误的结果。</p>
</li>
</ul>
</li>
</ol>
<hr>
<ol start="2">
<li>
<h3 id="从一个多维数组中提取指定内容，并构成新序列">从一个多维数组中提取指定内容，并构成新序列</h3>
<p><strong>知识点</strong>：</p>
<ul>
<li><strong><code>map</code>方法</strong>：将原数组映射为指定的形式，创建一个新数组，需要一个变量来承载新数组。</li>
<li><strong><code>=&gt;</code>箭头函数</strong>：函数的简写，结构为<code>参数 =&gt; 返回值</code>，类似于C的<code>lambda</code>。会继承外部的<code>this</code>，保持其指向不变。</li>
</ul>
<p><strong>情景</strong>：包含时间、传感器值的二维数据的数组，形如<code>[[11:45:14, 1.23], [11:45:14, 2.33]]</code>。需要从数组中提取时间轴和数值轴的数据序列，构成新数组，作为折线图的x轴和y轴数据源。</p>
<p><strong>方法</strong>：使用箭头函数提取指定的元素，用<code>map</code>方法将其映射为新的数组。</p>
<p><strong>例子</strong>：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> time = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dataList</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">dataList</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// 对每个dataList处理一次，将其中的所有第0或第1个元素返回，映射到一个新数组，作为time或者value保存下来</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol start="3">
<li>
<h3 id="处理错误的SetTimeout-函数">处理错误的<code>SetTimeout()</code>函数</h3>
<p><strong>知识点</strong>：<code>SetTimeout()</code>函数，延时结束后自动执行。延时单位是毫秒。</p>
<p><strong>情景</strong>：用户按下按钮，启动设备。你需要给用户返回不同的状态，你用<code>SetTimeout()</code>函数来判断超时，超时自动返回【连接失败】。</p>
<p>你很聪明，想到了要用标志位来解决，也就是设置一个标志位，例如<code>deviceState.start.success</code>来表征设备启用状态，当你监听到设备启用，执行回调，把这个值设置为<code>true</code>，<code>SetTimeout()</code>延时结束后判断这个值的真假，阻止设备启动后，显示错误状态。</p>
<p>但如果用户~~<em>在酒馆里点了一份炒饭</em>~~在设备成功启动后迅速点击关闭，然后再启用设备，假设上述过程在你设置的超时期限以内，那就会错误触发超时，返回【连接失败】。</p>
<p><strong>方法</strong>：在执行启动设备的指令成功后，清除定时器（前提是你能监听到执行成功）</p>
<p><strong>例子</strong>：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延时函数,先用一个变量保存延时函数</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">isDeviceLaunched</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">deviceState</span>.<span class="property">start</span>.<span class="property">success</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setDeviceState</span>(<span class="string">&#x27;start&#x27;</span>, <span class="string">&#x27;fail&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设备启用成功的回调</span></span><br><span class="line"><span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">deviceState</span>.<span class="property">start</span>.<span class="property">success</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setDeviceState</span>(<span class="string">&#x27;start&#x27;</span>, <span class="string">&#x27;succcess&#x27;</span>);</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">isDeviceLaunched</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol start="4">
<li>
<h3 id="Echarts图表：启用tooltip-axisPointer时的undefined错误">Echarts图表：启用<code>tooltip/axisPointer</code>时的<code>undefined</code>错误</h3>
<p><strong>知识点</strong>：<a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html"><code>Echarts</code>图表</a>（如需使用，请先阅读官方文档）/ <a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/option.html#axisPointer">axisPointer</a> / <a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/option.html#tooltip">tooltip</a></p>
<p><strong>情景</strong>：你引用<code>Apache Echarts</code>图表，使用折线图来显示一些传感器的值随时间的变化。但是你发现，点击某个数据点的时候，你并不知道它具体的值是多少。你认为这对用户来讲不太友好。所以你引入了<code>tooltip/axisPointer</code>，希望能够帮用户读清楚数据。</p>
<p>实际测试的时候，你发现了问题：假设10月20日的数据有5个点，10月21日的数据有2个点。当你点击10月20日的第3个数据，然后通过下拉菜单切换到10月21日。此时<code>tooltip/axisPointer</code>就有概率返回<code>undefined</code>值。</p>
<p><strong>原因</strong>：<code>tooltip/axisPointer</code>不会随着图表数据源的切换而刷新，原本10月21日的第3个点本来就没有值。</p>
<p><strong>方法</strong>：让需要的组件在切换数据源之后刷新一次就好了。</p>
<p><strong>例子</strong>：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由constant.js引入，只需重置tooltip，xAxis，yAxis，series四项即可避免undefined错误</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> newEchartsOption = &#123;</span><br><span class="line">  <span class="attr">tooltip</span>: echartsOption.<span class="property">tooltip</span>,</span><br><span class="line">  <span class="attr">xAxis</span>: echartsOption.<span class="property">xAxis</span>,</span><br><span class="line">  <span class="attr">yAxis</span>: echartsOption.<span class="property">yAxis</span>,</span><br><span class="line">  <span class="attr">series</span>: echartsOption.<span class="property">series</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用于重绘图表的函数</span></span><br><span class="line"><span class="title function_">redrawEchart</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> option = newEchartsOption</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chart</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chart</span>.<span class="title function_">setOption</span>(option, &#123;</span><br><span class="line">      <span class="attr">replaceMerge</span>: [<span class="string">&#x27;xAxis&#x27;</span>, <span class="string">&#x27;yAxis&#x27;</span>, <span class="string">&#x27;series&#x27;</span>, <span class="string">&#x27;tooltip&#x27;</span>]</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<ol start="5">
<li>
<h3 id="关于this">关于<code>this</code></h3>
<p>通常，在 JS 中，this 的真正决定因素是 <strong>函数被调用的方式</strong>。this 的指向并不确定。</p>
<p>而在微信小程序里，由于微信小程序框架会在你调用 <code>Page() </code>或 <code>Component() </code>时自动创建一个对象实例。这个实例就是页面或组件的“运行时对象”。</p>
<p>通常，一个页面自动创建的 JS ，结构是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">data1</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">data2</span>: &#123;<span class="attr">name1</span>: <span class="string">&#x27;test&#x27;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里引用<code>this</code>，微信框架会使它指向这个<code>Page</code>下的实例。换句话说，需要引用<code>Page</code>下的东西，都可以用<code>this</code>。</p>
<p>例如引用<code>data1</code>，就是<code>this.data.data1</code>。引用<code>name1</code>的<code>test</code>这个字串，就是<code>this.data.data2.name1</code>。</p>
<p>如果你在<code>Page</code>下自定义了一些函数，饮用方法也是如此。</p>
<p>例如下面的代码，在<code>onLoad</code>里调用<code>myFunction()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">data1</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">data2</span>: &#123;<span class="attr">name1</span>: <span class="string">&#x27;test&#x27;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">myFunction</span>();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">myFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;myFunction&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是由于<code>this</code>的特性，也可能出现一些问题。</p>
<p>例如在下面的代码中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">getStorageInfo</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功读取缓存信息&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">data1</span>: res,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>就会出现下面的报错：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">setData</span> is not a <span class="keyword">function</span></span><br></pre></td></tr></table></figure>
<p>这是由于<code>this</code>的作用域导致的。因为<code>success</code>是个闭包，无法直接获取外部的<code>this</code>结构，既然这些东西也就不存在。</p>
<p>解决办法也很简单，就是使用箭头函数，或者先传入<code>this</code>，再用<code>that</code>集成。箭头函数会继承外层的<code>this</code>，不改变其指向。</p>
<p>如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">getStorageInfo</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;成功读取缓存信息&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">data1</span>: res,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="持续更新中…">持续更新中…</h3>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.electro-dragon.site">ElectroDragon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.electro-dragon.site/2025/11/22/%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%90%83%E7%9A%84JavaScript%E5%B0%8F%E6%8A%80%E5%B7%A7/">https://blog.electro-dragon.site/2025/11/22/%E4%B8%80%E4%BA%9B%E5%A5%BD%E5%90%83%E7%9A%84JavaScript%E5%B0%8F%E6%8A%80%E5%B7%A7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.electro-dragon.site" target="_blank">ElectroDragon's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a></div><div class="post-share"><div class="social-share" data-image="https://blog-material.electro-dragon.site/my_avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/03/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new &quot;My New Post&quot; More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment </div></div></div></a><a class="pagination-related" href="/2025/11/25/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%85%BC%E5%AE%B9%E6%80%A7/" title="微信小程序的一些兼容性问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">微信小程序的一些兼容性问题</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://blog-material.electro-dragon.site/my_avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ElectroDragon</div><div class="author-info-description">一个啥也不会的菜鸡</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/SilverDragonYo"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%EF%BC%8C%E5%9C%A8%E5%8E%9F%E6%9C%89%E6%95%B0%E6%8D%AE%E7%9A%84%E5%90%8E%E9%9D%A2%E8%BF%BD%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">1.</span> <span class="toc-text">针对多维数组，在原有数据的后面追加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E6%8F%90%E5%8F%96%E6%8C%87%E5%AE%9A%E5%86%85%E5%AE%B9%EF%BC%8C%E5%B9%B6%E6%9E%84%E6%88%90%E6%96%B0%E5%BA%8F%E5%88%97"><span class="toc-number">2.</span> <span class="toc-text">从一个多维数组中提取指定内容，并构成新序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%E7%9A%84SetTimeout-%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">处理错误的SetTimeout()函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Echarts%E5%9B%BE%E8%A1%A8%EF%BC%9A%E5%90%AF%E7%94%A8tooltip-axisPointer%E6%97%B6%E7%9A%84undefined%E9%94%99%E8%AF%AF"><span class="toc-number">4.</span> <span class="toc-text">Echarts图表：启用tooltip&#x2F;axisPointer时的undefined错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ethis"><span class="toc-number">5.</span> <span class="toc-text">关于this</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%E4%B8%AD%E2%80%A6"><span class="toc-number">6.</span> <span class="toc-text">持续更新中…</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/17/ESP8266-IoT%E7%BD%91%E5%85%B3%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/" title="ESP8266 IoT网关开发记录">ESP8266 IoT网关开发记录</a><time datetime="2026-02-17T06:15:37.000Z" title="发表于 2026-02-17 14:15:37">2026-02-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/13/%E5%8D%83%E6%98%9F%E5%A5%87%E5%9F%9F%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/" title="千星奇域开发记录">千星奇域开发记录</a><time datetime="2026-02-13T15:02:42.000Z" title="发表于 2026-02-13 23:02:42">2026-02-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/14/%E4%BD%BF%E7%94%A8Cloudflare-Workers-%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%BF%80%E6%B4%BB%E7%A0%81%E6%A0%A1%E9%AA%8C%E8%84%9A%E6%9C%AC/" title="使用Cloudflare Workers写一个简单的激活码校验脚本">使用Cloudflare Workers写一个简单的激活码校验脚本</a><time datetime="2025-12-14T14:04:52.000Z" title="发表于 2025-12-14 22:04:52">2025-12-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/03/%E6%B8%94%E4%B8%9A%E9%A1%B9%E7%9B%AE%E5%88%9B%E6%96%B0%E7%82%B9(%E7%A5%9E%E7%A7%98%E5%9E%83%E5%9C%BE%E6%96%87%E6%A1%A3)/" title="渔业项目创新点（神秘垃圾文档）">渔业项目创新点（神秘垃圾文档）</a><time datetime="2025-12-03T14:13:52.000Z" title="发表于 2025-12-03 22:13:52">2025-12-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/29/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A4%87%E6%A1%88%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="微信小程序备案常见问题">微信小程序备案常见问题</a><time datetime="2025-11-29T07:46:45.000Z" title="发表于 2025-11-29 15:46:45">2025-11-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By ElectroDragon</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>